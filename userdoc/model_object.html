<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>modelオブジェクト &mdash; GetFEM++</title>
    
    <link rel="stylesheet" href="../static/getfem.css" type="text/css" />
    <link rel="stylesheet" href="../static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '5.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  false
      };
    </script>
    <script type="text/javascript" src="../static/jquery.js"></script>
    <script type="text/javascript" src="../static/underscore.js"></script>
    <script type="text/javascript" src="../static/doctools.js"></script>
    <script type="text/javascript" src="../static/translations.js"></script>
    <link rel="shortcut icon" href="../static/favicon.ico"/>
    <link rel="author" title="このドキュメントについて" href="../about.html" />
    <link rel="copyright" title="著作権" href="../copyright.html" />
    <link rel="top" title="GetFEM++" href="../index.html" />
    <link rel="up" title="モデル記述と基本モデルブリック要素" href="model.html" />
    <link rel="next" title="汎用的な構築ブリック要素" href="model_generic_assembly.html" />
    <link rel="prev" title="モデル記述と基本モデルブリック要素" href="model.html" />
    <link rel="shortcut icon" type="image/png" href="../static/icon.png" />
 

  </head>
  <body>
    <div class="related">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="総合索引"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="model_generic_assembly.html" title="汎用的な構築ブリック要素"
             accesskey="N">次へ</a> |</li>
        <li class="right" >
          <a href="model.html" title="モデル記述と基本モデルブリック要素"
             accesskey="P">前へ</a> |</li>
        <li><a href="https://savannah.nongnu.org/projects/getfem" <img src="../static/icon.png" alt=""
                 style="vertical-align: middle; margin-top: -1px"/></li></a>
        <li><a href="../index.html">GetFEM++</a> &raquo;</li>

          <li><a href="index.html" >ユーザドキュメント</a> &raquo;</li>
          <li><a href="model.html" accesskey="U">モデル記述と基本モデルブリック要素</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="the-model-object">
<span id="ud-model-object"></span><span id="index-0"></span><h1>modelオブジェクト<a class="headerlink" href="#the-model-object" title="このヘッドラインへのパーマリンク">¶</a></h1>
<p><tt class="file docutils literal"><span class="pre">getfem/getfem_models.h</span></tt> で定義されている <cite>model</cite> オブジェクトの目的は、微分方程式モデルをグローバルに記述することです。主に2つのリストがあります：変数のリスト（ <cite>mesh_fem</cite> オブジェクトに関連するかどうか）とデータ（これも <cite>mesh_fem</cite> オブジェクトに関連するかどうか）と項のリストです。 <cite>model</cite> の役割はモジュールを調整しそれらに式の線形システムを生成させることです。モデルが線形の場合、これは単純に対応するdofの式の線形システムになります。モデルが非線形の場合、これは接線系になります。 <cite>model</cite> オブジェクトは実数と複素数の2つのバージョンがあります。</p>
<p>modelオブジェクトの宣言は次の通りです。</p>
<div class="highlight-c++"><div class="highlight"><pre><span class="n">getfem</span><span class="o">::</span><span class="n">model</span> <span class="n">md</span><span class="p">(</span><span class="n">complex_version</span> <span class="o">=</span> <span class="nb">false</span><span class="p">);</span>
</pre></div>
</div>
<p>コンストラクタのパラメータは、モデルが複素数を扱うか実数を扱うかを決定するブール値です。デフォルトはfalseで実数を扱うモデルになります。</p>
<div class="figure align-center" id="ud-fig-syslin">
<img alt="../images/getfemuserlinearsys.png" src="../images/getfemuserlinearsys.png" />
<p class="caption">線形（接線）システム</p>
</div>
<p>モデルにはさまざまな種類の変数/データがあります。変数はモデルの未知数です。これらは、モデルによって構築された（接線）線形システムを解くことによって（汎用的に）計算されます。一般に、モデルにはいくつかの変数があります。各変数は一定の大きさ（自由度の数）を持ち、さまざまな変数は英数字順にソートされ、グローバルな未知数（図 <a class="reference internal" href="#ud-fig-syslin"><em>線形（接線）システム</em></a> の <img class="math" src="../images/math/e2bbebb3bd73f1ae5c64098ab0244f739abf7ca4.png" alt="U" style="vertical-align: 0px"/> ）を形成します。各変数はグローバルシステム内のこの変数に対応する自由度指標を表す <img class="math" src="../images/math/95876ba30e85990efbf432dd4acce472e5ed85d5.png" alt="I = [n_1, n_2]" style="vertical-align: -5px"/> という区間に関連付けられます。また、モデルはいくつかのデータを（変数と同じフォーマットで）保存します。データと変数の違いは、データがモデルの未知数ではないということです。データの値は提供する必要があります。いくつかの（非線形モデル）の場合によっては、いくつかの変数はある種のデータとして考えることができます。変数とデータは2種類あります。それらは固定サイズを有することができ、または有限積分法（有限積分法の自由度）に依存することができます。</p>
<p>例えば、図 <a class="reference internal" href="#ud-fig-syslin"><em>線形（接線）システム</em></a> に記述されている状況ではモデルには4つの変数、すなわち、 <img class="math" src="../images/math/cea8ffbc94d641e6d087b7af3d0930d00ad86fa9.png" alt="X, Y, V" style="vertical-align: -4px"/> と <img class="math" src="../images/math/10cb764f88509fb1c8012366993fdbee98f31bc5.png" alt="W" style="vertical-align: 0px"/> があります。modelオブジェクトの役割は、線形システムを構築すること、すなわち、各変数に対応する部分行列（ <img class="math" src="../images/math/1625382e7a9f674c0d784e6f6ee1416173cdb36a.png" alt="R_{X,X}, R_{Y,Y}, R_{V,V}" style="vertical-align: -6px"/>, と <img class="math" src="../images/math/33987c4d1de4952f9d8f30169b776381f2648740.png" alt="R_{W,W}" style="vertical-align: -6px"/>）を満たすことと2つの変数の間の項（ <img class="math" src="../images/math/4b4d60ff5a54c6e549c917a72a637dbd5e16fb41.png" alt="R_{X,Y}, R_{X,V}, R_{W,V}, \cdots" style="vertical-align: -6px"/> ）を結合することです。この異なる寄与はモデルに追加された異なる項によって与えられます。</p>
<p><cite>model</cite> オブジェクトの主な有用なメソッドは以下の通りです。</p>
<dl class="function">
<dt id="m.is_complex">
<tt class="descname">m.is_complex</tt><big>(</big><big>)</big><a class="headerlink" href="#m.is_complex" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>モデルが実数または複素数の未知数とデータを扱うかどうかを示すブール値です。</p>
</dd></dl>

<dl class="function">
<dt id="add_fixed_size_variable">
<tt class="descname">add_fixed_size_variable</tt><big>(</big>name, size, niter=1<big>)</big><a class="headerlink" href="#add_fixed_size_variable" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>固定サイズの変数を追加します。 <tt class="docutils literal"><span class="pre">name</span></tt> は変数を指定する文字列です。 <tt class="docutils literal"><span class="pre">niter</span></tt> は変数のコピー数です。</p>
</dd></dl>

<dl class="function">
<dt>
<tt class="descname">add_fixed_size_variable</tt><big>(</big>name, sizes, niter=1<big>)</big></dt>
<dd><p>固定サイズの変数を追加します。 <tt class="docutils literal"><span class="pre">name</span></tt> は変数を指定する文字列です。 <tt class="docutils literal"><span class="pre">sizes</span></tt> は行列やテンソルの固定サイズ変数の次元のベクトルです。 <tt class="docutils literal"><span class="pre">niter</span></tt> は変数のコピー数です。</p>
</dd></dl>

<dl class="function">
<dt id="add_fixed_size_data">
<tt class="descname">add_fixed_size_data</tt><big>(</big>name, size, niter=1<big>)</big><a class="headerlink" href="#add_fixed_size_data" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>固定サイズのデータを追加します。 <tt class="docutils literal"><span class="pre">name</span></tt> はデータを指定する文字列です。 <tt class="docutils literal"><span class="pre">niter</span></tt> はデータのコピー数です。</p>
</dd></dl>

<dl class="function">
<dt>
<tt class="descname">add_fixed_size_data</tt><big>(</big>name, sizes, niter=1<big>)</big></dt>
<dd><p>固定サイズのデータを追加します。 <tt class="docutils literal"><span class="pre">name</span></tt> はデータを指定する文字列です。 <tt class="docutils literal"><span class="pre">sizes</span></tt> は行列やテンソルの固定サイズ変数の次元のベクトルです。 <tt class="docutils literal"><span class="pre">niter</span></tt> はデータのコピー数です。</p>
</dd></dl>

<dl class="function">
<dt id="add_initialized_fixed_size_data">
<tt class="descname">add_initialized_fixed_size_data</tt><big>(</big>name, V<big>)</big><a class="headerlink" href="#add_initialized_fixed_size_data" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>与えられたベクトル <tt class="docutils literal"><span class="pre">V</span></tt> で初期化された固定サイズのデータを追加します。 <tt class="docutils literal"><span class="pre">name</span></tt> はデータを指定する文字列です。</p>
</dd></dl>

<dl class="function">
<dt id="add_initialized_scalar_data">
<tt class="descname">add_initialized_scalar_data</tt><big>(</big>name, e<big>)</big><a class="headerlink" href="#add_initialized_scalar_data" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>与えられたスカラー値 <tt class="docutils literal"><span class="pre">e</span></tt> で初期化されたサイズ1のデータを追加します。 <tt class="docutils literal"><span class="pre">name</span></tt> はデータを指定する文字列です。</p>
</dd></dl>

<dl class="function">
<dt id="add_fem_variable">
<tt class="descname">add_fem_variable</tt><big>(</big>name, mf, niter=1<big>)</big><a class="headerlink" href="#add_fem_variable" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>有限積分法 <tt class="docutils literal"><span class="pre">mf</span></tt> の自由度である変数を追加します。 <tt class="docutils literal"><span class="pre">name</span></tt> は変数を指定する文字列です。 <tt class="docutils literal"><span class="pre">niter</span></tt> は変数のコピー数です。</p>
</dd></dl>

<dl class="function">
<dt id="add_fem_data">
<tt class="descname">add_fem_data</tt><big>(</big>name, mf, niter=1<big>)</big><a class="headerlink" href="#add_fem_data" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>有限積分法 <tt class="docutils literal"><span class="pre">mf</span></tt> の自由度数のデータ追加します。 <tt class="docutils literal"><span class="pre">name</span></tt> はデータを指定する文字列です。 <tt class="docutils literal"><span class="pre">niter</span></tt> はデータのコピー数です。</p>
</dd></dl>

<dl class="function">
<dt id="add_initialized_fem_data">
<tt class="descname">add_initialized_fem_data</tt><big>(</big>name, mf, V, niter=1<big>)</big><a class="headerlink" href="#add_initialized_fem_data" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>与えられたベクトル <tt class="docutils literal"><span class="pre">V</span></tt> で初期化された有限積分法 <tt class="docutils literal"><span class="pre">mf</span></tt> の自由度数のデータを追加します。 <tt class="docutils literal"><span class="pre">name</span></tt> はデータを指定する文字列です。 <tt class="docutils literal"><span class="pre">niter</span></tt> はデータのコピー数です。</p>
</dd></dl>

<dl class="function">
<dt id="add_multiplier">
<tt class="descname">add_multiplier</tt><big>(</big>name, mf, primal_name, niter=1<big>)</big><a class="headerlink" href="#add_multiplier" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>有限積分法 <tt class="docutils literal"><span class="pre">mf</span></tt> にリンクされ、第一変数 <tt class="docutils literal"><span class="pre">primal_name</span></tt> 上の特定の制約（例えば、Dirichlet条件）のための乗数である特別な変数を追加します。最も重要なことは、線形独立の制約の集合だけを保持するために、 <tt class="docutils literal"><span class="pre">partial_mesh_fem</span></tt> オブジェクトにより自由度がフィルタリングされることです。これを確実にするために、乗数と原変数を結ぶ項を持つ項への呼び出しが行われ、独立した制約を抽出するための特別なアルゴリズムが呼び出されます。このアルゴリズムは、境界乗数に最適化されています（ gmm::range_basis を参照）。体積の積に注意して使用してください。 <tt class="docutils literal"><span class="pre">niter</span></tt> は変数のコピー数です。複素数項については、実部のみが乗数をフィルタリングするとみなされることに留意してください。</p>
</dd></dl>

<dl class="function">
<dt id="real_variable">
<tt class="descname">real_variable</tt><big>(</big>name, niter=1<big>)</big><a class="headerlink" href="#real_variable" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>変数またはデータのベクトル値にアクセスできます。実数バージョンです。</p>
</dd></dl>

<dl class="function">
<dt id="complex_variable">
<tt class="descname">complex_variable</tt><big>(</big>name, niter=1<big>)</big><a class="headerlink" href="#complex_variable" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>変数またはデータのベクトル値にアクセスできます。複素数バージョンです。</p>
</dd></dl>

<dl class="function">
<dt id="mesh_fem_of_variable">
<tt class="descname">mesh_fem_of_variable</tt><big>(</big>name<big>)</big><a class="headerlink" href="#mesh_fem_of_variable" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>定義されている変数の <cite>mesh_fem</cite> のリファレンスが与えられます。有限積分法変数でない場合は例外を返します。</p>
</dd></dl>

<dl class="function">
<dt id="real_tangent_matrix">
<tt class="descname">real_tangent_matrix</tt><big>(</big><big>)</big><a class="headerlink" href="#real_tangent_matrix" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>接線行列へのアクセスが与えられます。実数バージョンです。最初に接線系の計算を行う必要があります。</p>
</dd></dl>

<dl class="function">
<dt id="complex_tangent_matrix">
<tt class="descname">complex_tangent_matrix</tt><big>(</big><big>)</big><a class="headerlink" href="#complex_tangent_matrix" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>接線行列へのアクセスが与えられます。複素数バージョンです。最初に接線系の計算を行う必要があります。</p>
</dd></dl>

<dl class="function">
<dt id="real_rhs">
<tt class="descname">real_rhs</tt><big>(</big><big>)</big><a class="headerlink" href="#real_rhs" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>線形システムの右辺ベクトルへのアクセスが与えられます。実数バージョンです。最初に接線系の計算を行う必要があります。</p>
</dd></dl>

<dl class="function">
<dt id="complex_rhs">
<tt class="descname">complex_rhs</tt><big>(</big><big>)</big><a class="headerlink" href="#complex_rhs" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>線形システムの右辺ベクトルへのアクセスが与えられます。複素数バージョンです。最初に接線系の計算を行う必要があります。</p>
</dd></dl>

</div>
<div class="section" id="the-br-object">
<h1><cite>brick</cite> オブジェクト<a class="headerlink" href="#the-br-object" title="このヘッドラインへのパーマリンク">¶</a></h1>
<p>model brickとはモデルの部分を表すオブジェクトです。このオブジェクトは微分方程式モデルの弱定式化でいくつかの積分項を表現するためにあります。modelオブジェクトにはブリック要素のリストが含まれます。ブリック要素によって記述されたすべての項は最終的に線形システム（非線形問題のための接線系）を構築するために構築られます。例えばもし項 <img class="math" src="../images/math/ac517564187407fe83e4d6f7c980030ac8aef437.png" alt="\Delta u" style="vertical-align: 0px"/> が微分方程式モデル上に存在します（ <img class="math" src="../images/math/9ad99798ec4c38e165cf517cb9e02b1c9e824103.png" alt="u" style="vertical-align: 0px"/> のLaplacian）、次いで弱定式化には:math:<cite>int_{Omega}nabla ucdotnabla vdx</cite> 項が含まれます。ここで <img class="math" src="../images/math/a9f23bf124b6b2b2a993eb313c72e678664ac74a.png" alt="v" style="vertical-align: 0px"/> は <img class="math" src="../images/math/9ad99798ec4c38e165cf517cb9e02b1c9e824103.png" alt="u" style="vertical-align: 0px"/> に対応する試行関数です。対応するブリック要素の役割は:math:<cite>int_{Omega}nablavarphi_i cdotnablavarphi_jdx</cite> 項をアセンブルすることです、 <img class="math" src="../images/math/87686aa0f5136421c8415c7169adcb308e36c7a8.png" alt="\varphi_i" style="vertical-align: -4px"/> と <img class="math" src="../images/math/d41fca1e2de11eadb57f7dbbcf8bb44ab85d088d.png" alt="\varphi_j" style="vertical-align: -6px"/> は <img class="math" src="../images/math/9ad99798ec4c38e165cf517cb9e02b1c9e824103.png" alt="u" style="vertical-align: 0px"/> を記述する有限積分法の形状関数です。この項はmodelオブジェクトによって変数  <img class="math" src="../images/math/9ad99798ec4c38e165cf517cb9e02b1c9e824103.png" alt="u" style="vertical-align: 0px"/> に対応する対角ブロック上の全体線形システムに追加されます。したがって、ブリック要素の唯一の役割はmodelオブジェクトがそれを求めるときに対応する構築手順を呼び出すことです。このように線形項のための項の構築は非常に簡単です。</p>
<p>基本的には、brickオブジェクトは <tt class="file docutils literal"><span class="pre">getfem/getfem_models.h</span></tt> で定義された <tt class="docutils literal"><span class="pre">virtual_brick</span></tt> オブジェクトから派生し、 実数項か固有の複素数項かによって <tt class="docutils literal"><span class="pre">asm_real_tangent_terms</span></tt> または <tt class="docutils literal"><span class="pre">asm_complex_tangent_terms</span></tt> メソッドを再定義する必要があります。</p>
</div>
<div class="section" id="how-to-build-a-new-brick">
<h1>新しい項を作る方法<a class="headerlink" href="#how-to-build-a-new-brick" title="このヘッドラインへのパーマリンク">¶</a></h1>
<p>まず最初に、新しい項の設計は、既存の項ではカバーされず、汎用的な構築項の幅広いアクセシブルな項（複雑な結合条件を含む）でカバーされていない特別な項に対してのみ必要である点に注意してください（ <a class="reference internal" href="model_generic_assembly.html#ud-model-generic-assembly"><em>汎用的な構築ブリック要素</em></a> ）。</p>
<p>設計思想によれば、項は追加のデータをできるだけ保存しないようにすべきです。ブリック要素のパラメータはモデルの変数とデータに含める必要があります。例えば、線形弾性ブリック要素のパラメータは弾性係数です。この係数はモデルの何らかのデータでなければなりません。項がmodelオブジェクトによって呼び出されると、変数とデータのリストが項に与えられます。あらかじめ定義された項の大部分はデータを格納しません。これにより、そのような項を一度だけインスタンス化することができます。</p>
<p>Laplacian項に対応するブリック要素の例は次のとおりです（他の例は標準的な項を含むファイル <tt class="file docutils literal"><span class="pre">getfem_models.cc</span></tt> で確認できます）。</p>
<div class="highlight-c++"><div class="highlight"><pre><span class="k">struct</span> <span class="n">my_Laplacian_brick</span><span class="o">:</span> <span class="k">public</span> <span class="n">getfem</span><span class="o">::</span><span class="n">virtual_brick</span> <span class="p">{</span>

  <span class="kt">void</span> <span class="n">asm_real_tangent_terms</span><span class="p">(</span><span class="k">const</span> <span class="n">getfem</span><span class="o">::</span><span class="n">model</span> <span class="o">&amp;</span><span class="n">md</span><span class="p">,</span> <span class="n">size_type</span> <span class="n">ib</span><span class="p">,</span>
                              <span class="k">const</span> <span class="n">getfem</span><span class="o">::</span><span class="n">model</span><span class="o">::</span><span class="n">varnamelist</span> <span class="o">&amp;</span><span class="n">varl</span><span class="p">,</span>
                              <span class="k">const</span> <span class="n">getfem</span><span class="o">::</span><span class="n">model</span><span class="o">::</span><span class="n">varnamelist</span> <span class="o">&amp;</span><span class="n">datal</span><span class="p">,</span>
                              <span class="k">const</span> <span class="n">getfem</span><span class="o">::</span><span class="n">model</span><span class="o">::</span><span class="n">mimlist</span> <span class="o">&amp;</span><span class="n">mims</span><span class="p">,</span>
                              <span class="n">getfem</span><span class="o">::</span><span class="n">model</span><span class="o">::</span><span class="n">real_matlist</span> <span class="o">&amp;</span><span class="n">matl</span><span class="p">,</span>
                              <span class="n">getfem</span><span class="o">::</span><span class="n">model</span><span class="o">::</span><span class="n">real_veclist</span> <span class="o">&amp;</span><span class="n">vecl</span><span class="p">,</span>
                              <span class="n">getfem</span><span class="o">::</span><span class="n">model</span><span class="o">::</span><span class="n">real_veclist</span> <span class="o">&amp;</span><span class="n">vecl_sym</span><span class="p">,</span>
                              <span class="n">size_type</span> <span class="n">region</span><span class="p">,</span> <span class="n">build_version</span> <span class="n">nl</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
    <span class="n">GMM_ASSERT1</span><span class="p">(</span><span class="n">matl</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s">&quot;My Laplacian brick has one and only one term&quot;</span><span class="p">);</span>
    <span class="n">GMM_ASSERT1</span><span class="p">(</span><span class="n">mims</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s">&quot;My Laplacian brick need one and only one mesh_im&quot;</span><span class="p">);</span>
    <span class="n">GMM_ASSERT1</span><span class="p">(</span><span class="n">varl</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">datal</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s">&quot;Wrong number of variables for my Laplacian brick&quot;</span><span class="p">);</span>

    <span class="k">const</span> <span class="n">getfem</span><span class="o">::</span><span class="n">mesh_fem</span> <span class="o">&amp;</span><span class="n">mf_u</span> <span class="o">=</span> <span class="n">md</span><span class="p">.</span><span class="n">mesh_fem_of_variable</span><span class="p">(</span><span class="n">varl</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
    <span class="k">const</span> <span class="n">getfem</span><span class="o">::</span><span class="n">mesh_im</span> <span class="o">&amp;</span><span class="n">mim</span> <span class="o">=</span> <span class="o">*</span><span class="n">mims</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>

    <span class="n">gmm</span><span class="o">::</span><span class="n">clear</span><span class="p">(</span><span class="n">matl</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
    <span class="n">getfem</span><span class="o">::</span><span class="n">asm_stiffness_matrix_for_homogeneous_laplacian</span>
    <span class="p">(</span><span class="n">matl</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">mim</span><span class="p">,</span> <span class="n">mf_u</span><span class="p">,</span> <span class="n">region</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="n">my_Laplacian_brick</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
  <span class="p">{</span> <span class="n">set_flags</span><span class="p">(</span><span class="s">&quot;My Laplacian brick&quot;</span><span class="p">,</span> <span class="nb">true</span> <span class="cm">/* linear */</span><span class="p">,</span>
                                    <span class="nb">true</span> <span class="cm">/* symmetric */</span><span class="p">,</span>
                                    <span class="nb">true</span> <span class="cm">/* coercivity */</span><span class="p">,</span>
                                    <span class="nb">true</span> <span class="cm">/* real version defined */</span><span class="p">,</span>
                                    <span class="nb">false</span> <span class="cm">/* no complex version*/</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>
</pre></div>
</div>
<p>項のコンストラクタは <tt class="docutils literal"><span class="pre">set_flags</span></tt> メソッドを呼び出す必要があります。このメソッドの最初のパラメータは項の名前です（これにより、モデルの項をリストしその識別を容易にすることができます）。その他のパラメータは、それぞれ次のフラグです。</p>
<ul class="simple">
<li><p class="first">ブリック要素項がすべて線形であるかどうかを示します。</p>
</li>
<li><p class="first">ブリック要素項が全体的に対称（複素数の場合で共役）か、少なくとも対称性に影響を与えていないか。 2つの異なる変数にで対称に宣言された項は全体線形システム（項と項の転置）で2回追加されます。</p>
</li>
<li><p class="first">その項が保磁力に影響を与えないか。</p>
</li>
<li><p class="first">項が実数のバージョンを持っているかどうか。もしそうなら、 <tt class="docutils literal"><span class="pre">asm_real_tangent_terms</span></tt> メソッドを再定義する必要があります。</p>
</li>
<li><p class="first">項が複素数バージョンを持っているかどうか。もしそうなら、 <tt class="docutils literal"><span class="pre">asm_complex_tangent_terms</span></tt> メソッドを再定義する必要があります。</p>
</li>
</ul>
<p><tt class="docutils literal"><span class="pre">asm_real_tangent_terms</span></tt> メソッドは、タンジェントシステムの構築のためのmodelオブジェクトによって呼び出されます。modelオブジェクトはブリック要素にフレームワーク全体を渡してその項を構築します。 <tt class="docutils literal"><span class="pre">asm_real_tangent_terms</span></tt> メソッドのパラメータ <tt class="docutils literal"><span class="pre">md</span></tt> は項を呼び出すモデルであり、 <tt class="docutils literal"><span class="pre">ib</span></tt> はモデルの項数です。パラメータ <tt class="docutils literal"><span class="pre">varl</span></tt> はこのモデルで定義される項で必要とされる変数/データ名の配列です。 <tt class="docutils literal"><span class="pre">mims</span></tt> は <cite>mesh_im</cite> ポインタの配列です。これは、項を構築するために必要な積分法に対応します。 <tt class="docutils literal"><span class="pre">matl</span></tt> は計算された行列の配列です。 <tt class="docutils literal"><span class="pre">vecl</span></tt> は計算されるベクトルの配列です（rhsまたは残差ベクトル）。 <tt class="docutils literal"><span class="pre">vecl_sym</span></tt> は対称項に対してのみ計算され、第2の変数のrhsに対応するベクトルの配列です。項は任意の数の項を持つことができます。それぞれの項について、少なくとも対応する行列または対応するベクトルを満たされなければなりません（または2つとも、非線形の場合のみ、次のセクションを参照）。 <tt class="docutils literal"><span class="pre">region</span></tt> は、特定の領域に項を構築することを示すメッシュ領域番号です。 <tt class="docutils literal"><span class="pre">nl</span></tt> は非線形項のみです。これは接線行列または残差または両方を計算するか（線形項の場合は、すべての呼び出しごとに計算されます）を示します。</p>
<p>上で定義した非常に単純なLaplacian項の場合、1つの変数のみが使用され、データはなく、1つの項しか存在しません。行</p>
<div class="highlight-c++"><div class="highlight"><pre><span class="n">GMM_ASSERT1</span><span class="p">(</span><span class="n">matl</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s">&quot;My Laplacian brick has one and only one term&quot;</span><span class="p">);</span>
<span class="n">GMM_ASSERT1</span><span class="p">(</span><span class="n">mims</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s">&quot;My Laplacian brick need one and only one mesh_im&quot;</span><span class="p">);</span>
<span class="n">GMM_ASSERT1</span><span class="p">(</span><span class="n">varl</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">datal</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s">&quot;Wrong number of variables for my Laplacian brick&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>は必須ではなく、項の数（1）、積分法（1）、変数（1）、データ（0）が  <tt class="docutils literal"><span class="pre">asm_real_tangent_terms</span></tt> メソッドに渡されるのに問題ない値であることを確認するだけです。</p>
<p>行</p>
<div class="highlight-c++"><div class="highlight"><pre><span class="k">const</span> <span class="n">getfem</span><span class="o">::</span><span class="n">mesh_fem</span> <span class="o">&amp;</span><span class="n">mf_u</span> <span class="o">=</span> <span class="n">md</span><span class="p">.</span><span class="n">mesh_fem_of_variable</span><span class="p">(</span><span class="n">varl</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
<span class="k">const</span> <span class="n">getfem</span><span class="o">::</span><span class="n">mesh_im</span> <span class="o">&amp;</span><span class="n">mim</span> <span class="o">=</span> <span class="o">*</span><span class="n">mims</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
</pre></div>
</div>
<p>はLaplacian項が追加される変数の <cite>mesh_fem</cite> オブジェクトで <cite>mesh_im</cite> オブジェクトは積分法のリストです。最後に</p>
<div class="highlight-c++"><div class="highlight"><pre><span class="n">gmm</span><span class="o">::</span><span class="n">clear</span><span class="p">(</span><span class="n">matl</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
<span class="n">getfem</span><span class="o">::</span><span class="n">asm_stiffness_matrix_for_homogeneous_laplacian</span>
<span class="p">(</span><span class="n">matl</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">mim</span><span class="p">,</span> <span class="n">mf_u</span><span class="p">,</span> <span class="n">region</span><span class="p">);</span>
</pre></div>
</div>
<p>はファイル <tt class="file docutils literal"><span class="pre">getfem/getfem_assembling.h</span></tt> で定義されているLaplacian項の標準構築手順を呼び出します。 <tt class="docutils literal"><span class="pre">matl</span></tt> の行列は適切なサイズであることが保証されていますが、 <tt class="docutils literal"><span class="pre">asm_real_tangent_terms</span></tt> の呼び出しの前に初期化されない可能性があるので、初期化メソッドが必要です。</p>
<p>この単純な項は項が1つしかなく、線形であることに注意してください。線形ブリック要素の場合、行列または右辺のベクトルのどちらか一方を埋める必要がありますが、両方を埋める必要はありません。項の宣言に応じて。モデルにブリック要素を積分する方法は以下を参照してください。</p>
<p>Lagrange乗数の使用によりDirichlet条件を規定する単純な項の2番目の例を見てみましょう。Dirichlet条件は、</p>
<div class="math">
<p><img src="../images/math/7a47716f1abe5f52c8709969c545855b15eba370.png" alt="u = u_D \text{ on } \Gamma,"/></p>
</div><p>ここで、 <img class="math" src="../images/math/9ad99798ec4c38e165cf517cb9e02b1c9e824103.png" alt="u" style="vertical-align: 0px"/> は変数で、 <img class="math" src="../images/math/64f650be582a1056128d1394c1bc9141f7e2d839.png" alt="u_D" style="vertical-align: -3px"/> は与えられた値で、<img class="math" src="../images/math/913e49ea63c6c130bb8d9d1c3556b052ecc404f8.png" alt="\Gamma" style="vertical-align: -1px"/> は対象とする領域の境界上にある部分です。Lagrange乗数で規定されたこの条件に対応する弱定式項は、</p>
<div class="math">
<p><img src="../images/math/c84c280611629635cd6d7b8cec131e21269845a9.png" alt="\int_{\Gamma} u \mu\ d\Gamma = \int_{\Gamma} u_D \mu\ d\Gamma, \forall \mu \in M,"/></p>
</div><p>ここで、 <img class="math" src="../images/math/5d1e4485dc90c450e8c76826516c1b2ccb8fce16.png" alt="M" style="vertical-align: 0px"/> は適切な乗数空間です。グローバル線形システムへの寄与は、図 <a class="reference internal" href="#ud-fig-syslindir"><em>シンプルなDirichletブリック要素の寄与</em></a> で見ることができます。行列 <img class="math" src="../images/math/ff5fb3d775862e2123b007eb4373ff6cc1a34d4e.png" alt="B" style="vertical-align: 0px"/> は変数の有限要素空間 <img class="math" src="../images/math/9ad99798ec4c38e165cf517cb9e02b1c9e824103.png" alt="u" style="vertical-align: 0px"/> と乗数の有限要素空間 <img class="math" src="../images/math/2d8c833ed800824727cd7bd2fb9de1a12ad7e674.png" alt="\mu" style="vertical-align: -4px"/> の間の &#8220;質量行列&#8221; です。 <img class="math" src="../images/math/637e8f50a7c1c2b086bc912e5a4ed9248dd17304.png" alt="L_{u}" style="vertical-align: -3px"/> はデータ <img class="math" src="../images/math/64f650be582a1056128d1394c1bc9141f7e2d839.png" alt="u_D" style="vertical-align: -3px"/> に対応する右辺です。</p>
<div class="figure align-center" id="ud-fig-syslindir">
<a class="reference internal image-reference" href="../images/getfemuserlinsysDir.png"><img alt="../images/getfemuserlinsysDir.png" src="../images/getfemuserlinsysDir.png" style="width: 7cm;" /></a>
<p class="caption">シンプルなDirichletブリック要素の寄与</p>
</div>
<p>項は次のように定義できます。</p>
<div class="highlight-c++"><div class="highlight"><pre><span class="k">struct</span> <span class="n">my_Dirichlet_brick</span><span class="o">:</span> <span class="k">public</span> <span class="n">getfem</span><span class="o">::</span><span class="n">virtual_brick</span> <span class="p">{</span>

  <span class="kt">void</span> <span class="n">asm_real_tangent_terms</span><span class="p">(</span><span class="k">const</span> <span class="n">getfem</span><span class="o">::</span><span class="n">model</span> <span class="o">&amp;</span><span class="n">md</span><span class="p">,</span> <span class="n">size_type</span> <span class="n">ib</span><span class="p">,</span>
                              <span class="k">const</span> <span class="n">getfem</span><span class="o">::</span><span class="n">model</span><span class="o">::</span><span class="n">varnamelist</span> <span class="o">&amp;</span><span class="n">varl</span><span class="p">,</span>
                              <span class="k">const</span> <span class="n">getfem</span><span class="o">::</span><span class="n">model</span><span class="o">::</span><span class="n">varnamelist</span> <span class="o">&amp;</span><span class="n">datal</span><span class="p">,</span>
                              <span class="k">const</span> <span class="n">getfem</span><span class="o">::</span><span class="n">model</span><span class="o">::</span><span class="n">mimlist</span> <span class="o">&amp;</span><span class="n">mims</span><span class="p">,</span>
                              <span class="n">getfem</span><span class="o">::</span><span class="n">model</span><span class="o">::</span><span class="n">real_matlist</span> <span class="o">&amp;</span><span class="n">matl</span><span class="p">,</span>
                              <span class="n">getfem</span><span class="o">::</span><span class="n">model</span><span class="o">::</span><span class="n">real_veclist</span> <span class="o">&amp;</span><span class="n">vecl</span><span class="p">,</span>
                              <span class="n">getfem</span><span class="o">::</span><span class="n">model</span><span class="o">::</span><span class="n">real_veclist</span> <span class="o">&amp;</span><span class="n">vecl_sym</span><span class="p">,</span>
                              <span class="n">size_type</span> <span class="n">region</span><span class="p">,</span> <span class="n">build_version</span> <span class="n">nl</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
    <span class="n">GMM_ASSERT1</span><span class="p">(</span><span class="n">matl</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s">&quot;My Dirichlet brick has one and only one term&quot;</span><span class="p">);</span>
    <span class="n">GMM_ASSERT1</span><span class="p">(</span><span class="n">mims</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s">&quot;My Dirichlet brick need one and only one mesh_im&quot;</span><span class="p">);</span>
    <span class="n">GMM_ASSERT1</span><span class="p">(</span><span class="n">varl</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">&amp;&amp;</span> <span class="n">datal</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s">&quot;Wrong number of variables for my Laplacian brick&quot;</span><span class="p">);</span>

    <span class="k">const</span> <span class="n">getfem</span><span class="o">::</span><span class="n">mesh_fem</span> <span class="o">&amp;</span><span class="n">mf_u</span> <span class="o">=</span> <span class="n">md</span><span class="p">.</span><span class="n">mesh_fem_of_variable</span><span class="p">(</span><span class="n">varl</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
    <span class="k">const</span> <span class="n">getfem</span><span class="o">::</span><span class="n">mesh_fem</span> <span class="o">&amp;</span><span class="n">mf_mult</span> <span class="o">=</span> <span class="n">md</span><span class="p">.</span><span class="n">mesh_fem_of_variable</span><span class="p">(</span><span class="n">varl</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
    <span class="k">const</span> <span class="n">getfem</span><span class="o">::</span><span class="n">mesh_im</span> <span class="o">&amp;</span><span class="n">mim</span> <span class="o">=</span> <span class="o">*</span><span class="n">mims</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="k">const</span> <span class="n">getfem</span><span class="o">::</span><span class="n">model_real_plain_vector</span> <span class="o">&amp;</span><span class="n">A</span> <span class="o">=</span> <span class="n">md</span><span class="p">.</span><span class="n">real_variable</span><span class="p">(</span><span class="n">datal</span><span class="p">[</span><span class="n">ind</span><span class="p">]);</span>
    <span class="k">const</span> <span class="n">getfem</span><span class="o">::</span><span class="n">mesh_fem</span> <span class="o">*</span><span class="n">mf_data</span> <span class="o">=</span> <span class="n">md</span><span class="p">.</span><span class="n">pmesh_fem_of_variable</span><span class="p">(</span><span class="n">datal</span><span class="p">[</span><span class="n">ind</span><span class="p">]);</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">mf_data</span><span class="p">)</span>
      <span class="n">getfem</span><span class="o">::</span><span class="n">asm_source_term</span><span class="p">(</span><span class="n">vecl</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">mim</span><span class="p">,</span> <span class="n">mf_mult</span><span class="p">,</span> <span class="o">*</span><span class="n">mf_data</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">region</span><span class="p">);</span>
    <span class="k">else</span>
      <span class="n">getfem</span><span class="o">::</span><span class="n">asm_homogeneous_source_term</span><span class="p">(</span><span class="n">vecl</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">mim</span><span class="p">,</span> <span class="n">mf_mult</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">region</span><span class="p">);</span>

    <span class="n">gmm</span><span class="o">::</span><span class="n">clear</span><span class="p">(</span><span class="n">matl</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
    <span class="n">getfem</span><span class="o">::</span><span class="n">asm_mass_matrix</span><span class="p">(</span><span class="n">matl</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">mim</span><span class="p">,</span> <span class="n">mf_mult</span><span class="p">,</span> <span class="n">mf_u</span><span class="p">,</span> <span class="n">region</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="n">my_Dirichlet_brick</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
  <span class="p">{</span> <span class="n">set_flags</span><span class="p">(</span><span class="s">&quot;My Dirichlet brick&quot;</span><span class="p">,</span> <span class="nb">true</span> <span class="cm">/* linear */</span><span class="p">,</span>
                                    <span class="nb">true</span> <span class="cm">/* symmetric */</span><span class="p">,</span>
                                    <span class="nb">false</span> <span class="cm">/* coercivity */</span><span class="p">,</span>
                                    <span class="nb">true</span> <span class="cm">/* real version defined */</span><span class="p">,</span>
                                    <span class="nb">false</span> <span class="cm">/* no complex version */</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>
</pre></div>
</div>
<p>このブリック要素にも項が1つしかありませんが、マトリックス部分と右辺部分の両方が定義されています。Dirichlet条件が規定されているプライマリ変数と、境界に対応するメッシュ領域に定義される乗数変数（ <tt class="docutils literal"><span class="pre">add_multiplier</span></tt> メソッドでモデルに追加する必要があります）の2つの変数が関係しています。項は対称であると宣言されます（次のセクションを参照）。</p>
<p>行</p>
<div class="highlight-c++"><div class="highlight"><pre><span class="k">const</span> <span class="n">getfem</span><span class="o">::</span><span class="n">model_real_plain_vector</span> <span class="o">&amp;</span><span class="n">A</span> <span class="o">=</span> <span class="n">md</span><span class="p">.</span><span class="n">real_variable</span><span class="p">(</span><span class="n">datal</span><span class="p">[</span><span class="n">ind</span><span class="p">]);</span>
<span class="k">const</span> <span class="n">getfem</span><span class="o">::</span><span class="n">mesh_fem</span> <span class="o">*</span><span class="n">mf_data</span> <span class="o">=</span> <span class="n">md</span><span class="p">.</span><span class="n">pmesh_fem_of_variable</span><span class="p">(</span><span class="n">datal</span><span class="p">[</span><span class="n">ind</span><span class="p">]);</span>
</pre></div>
</div>
<p>はDirichlet状態の右辺に対応するデータの値とこのデータが定義されている <cite>mesh_fem</cite> にアクセスすることを許可します。データが一定である場合（有限要素法で記述されていない場合）、 <tt class="docutils literal"><span class="pre">mf_data</span></tt> はヌルポインタです。</p>
<p>行</p>
<div class="highlight-c++"><div class="highlight"><pre><span class="k">if</span> <span class="p">(</span><span class="n">mf_data</span><span class="p">)</span>
  <span class="n">getfem</span><span class="o">::</span><span class="n">asm_source_term</span><span class="p">(</span><span class="n">vecl</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">mim</span><span class="p">,</span> <span class="n">mf_mult</span><span class="p">,</span> <span class="o">*</span><span class="n">mf_data</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">region</span><span class="p">);</span>
<span class="k">else</span>
  <span class="n">getfem</span><span class="o">::</span><span class="n">asm_homogeneous_source_term</span><span class="p">(</span><span class="n">vecl</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">mim</span><span class="p">,</span> <span class="n">mf_mult</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">region</span><span class="p">);</span>
</pre></div>
</div>
<p>は右辺を構築します。 2つのバージョンは有限要素法または一定サイズのデータで定義されたデータに対応します。</p>
<p>（+非線形項を持ついくつかの例...）</p>
</div>
<div class="section" id="how-to-add-the-brick-to-a-model">
<h1>モデルに項を追加する方法<a class="headerlink" href="#how-to-add-the-brick-to-a-model" title="このヘッドラインへのパーマリンク">¶</a></h1>
<p>モデルに項を追加するには、モデルに特定の情報を渡す必要があります。</p>
<ul class="simple">
<li><p class="first">ブリック要素自体へのポインタ。</p>
</li>
<li><p class="first">ブリック要素の項に関係する一連の変数名。</p>
</li>
<li><p class="first">データ名の集合は、ブリック要素の項に関係します。</p>
</li>
<li><p class="first">項の説明のリスト。</p>
</li>
<li><p class="first">積分法のリスト。</p>
</li>
<li><p class="first">最終的に関連するメッシュ領域。</p>
</li>
</ul>
<p>これは、オブジェクトメソッド <cite>model</cite> の呼び出しによって行われます。</p>
<div class="highlight-c++"><div class="highlight"><pre><span class="n">md</span><span class="p">.</span><span class="n">add_brick</span><span class="p">(</span><span class="n">pbr</span><span class="p">,</span> <span class="k">const</span> <span class="n">getfem</span><span class="o">::</span><span class="n">model</span><span class="o">::</span><span class="n">varnamelist</span> <span class="o">&amp;</span><span class="n">varnames</span><span class="p">,</span>
                  <span class="k">const</span> <span class="n">getfem</span><span class="o">::</span><span class="n">model</span><span class="o">::</span><span class="n">varnamelist</span> <span class="o">&amp;</span><span class="n">datanames</span><span class="p">,</span>
                  <span class="k">const</span> <span class="n">getfem</span><span class="o">::</span><span class="n">model</span><span class="o">::</span><span class="n">termlist</span> <span class="o">&amp;</span><span class="n">terms</span><span class="p">,</span>
                  <span class="k">const</span> <span class="n">getfem</span><span class="o">::</span><span class="n">model</span><span class="o">::</span><span class="n">mimlist</span> <span class="o">&amp;</span><span class="n">mims</span><span class="p">,</span>
                  <span class="kt">size_t</span> <span class="n">region</span><span class="p">);</span>
</pre></div>
</div>
<p>このメソッドは、モデル内の項のインデックスを返します。このメソッドの呼び出しは、多くの状況に適応できるため、かなり複雑です。新しいブリック要素の構築は、このメソッドを呼び出すモデルに新しいブリック要素を追加し、より簡単に使用できる関数の定義に従わなければなりません。</p>
<p>例えば、上記の単純なLaplacian項の場合、この関数は次のように定義することができます。</p>
<div class="highlight-c++"><div class="highlight"><pre><span class="kt">size_t</span> <span class="nf">add_my_Laplacian_brick</span><span class="p">(</span><span class="n">getfem</span><span class="o">::</span><span class="n">model</span> <span class="o">&amp;</span><span class="n">md</span><span class="p">,</span> <span class="k">const</span> <span class="n">getfem</span><span class="o">::</span><span class="n">mesh_im</span> <span class="o">&amp;</span><span class="n">mim</span><span class="p">,</span>
                              <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">varname</span><span class="p">,</span>
                              <span class="kt">size_t</span> <span class="n">region</span> <span class="o">=</span> <span class="kt">size_t</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
  <span class="n">getfem</span><span class="o">::</span><span class="n">pbrick</span> <span class="n">pbr</span> <span class="o">=</span> <span class="k">new</span> <span class="n">my_Laplacian_brick</span><span class="p">;</span>
  <span class="n">getfem</span><span class="o">::</span><span class="n">model</span><span class="o">::</span><span class="n">termlist</span> <span class="n">tl</span><span class="p">;</span>

  <span class="n">tl</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">getfem</span><span class="o">::</span><span class="n">model</span><span class="o">::</span><span class="n">term_description</span><span class="p">(</span><span class="n">varname</span><span class="p">,</span> <span class="n">varname</span><span class="p">,</span> <span class="nb">true</span><span class="p">));</span>
  <span class="k">return</span> <span class="n">md</span><span class="p">.</span><span class="n">add_brick</span><span class="p">(</span><span class="n">pbr</span><span class="p">,</span> <span class="n">getfem</span><span class="o">::</span><span class="n">model</span><span class="o">::</span><span class="n">varnamelist</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">varname</span><span class="p">),</span>
                      <span class="n">getfem</span><span class="o">::</span><span class="n">model</span><span class="o">::</span><span class="n">varnamelist</span><span class="p">(),</span> <span class="n">tl</span><span class="p">,</span>
                      <span class="n">getfem</span><span class="o">::</span><span class="n">model</span><span class="o">::</span><span class="n">mimlist</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">mim</span><span class="p">),</span> <span class="n">region</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>この関数はあなたのブリック要素のユーザーによって呼び出されます。 <tt class="docutils literal"><span class="pre">getfem::model::varnamelist</span></tt> 型は <tt class="docutils literal"><span class="pre">std::vector&lt;std::string&gt;</span></tt> であり、変数名の配列を表します。 <tt class="docutils literal"><span class="pre">getfem::model::mimlist</span></tt> 型は <tt class="docutils literal"><span class="pre">std::vector&lt;const</span> <span class="pre">getfem::mesh_im</span> <span class="pre">*&gt;</span></tt> であり、積分法へのポインタの配列を表します。 <tt class="docutils literal"><span class="pre">getfem::model::termlist</span></tt> は項の記述の配列です。項には2種類あります。線形（接線）システムに右辺のみを追加する項は次のようにリストに追加する必要があります。</p>
<div class="highlight-c++"><div class="highlight"><pre><span class="n">tl</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">getfem</span><span class="o">::</span><span class="n">model</span><span class="o">::</span><span class="n">term_description</span><span class="p">(</span><span class="n">varname</span><span class="p">));</span>
</pre></div>
</div>
<p>そして、線形システムの行列に寄与する項は次のようにリストに追加する必要があります。</p>
<div class="highlight-c++"><div class="highlight"><pre><span class="n">tl</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">getfem</span><span class="o">::</span><span class="n">model</span><span class="o">::</span><span class="n">term_description</span><span class="p">(</span><span class="n">varname1</span><span class="p">,</span> <span class="n">varname2</span><span class="p">,</span> <span class="nb">true</span><span class="o">/</span><span class="nb">false</span><span class="p">));</span>
</pre></div>
</div>
<p>この場合、行列項は変数 &#8220;varname1&#8221; に対応する行と変数 &#8220;varname2&#8221; に対応する列に追加されます。第3のパラメータであるブール値はその項が対称であるかどうかを宣言します。対称であり、2つの変数が異なる場合、構築手順は対応する項およびその転置を加えます。項の数は任意です。宣言された各項に対して、項は対応する右辺のベクトル（上の <tt class="docutils literal"><span class="pre">asm_real_tangent_terms</span></tt> のパラメータ <tt class="docutils literal"><span class="pre">vecl</span></tt> ）または/および行列の項（ <tt class="docutils literal"><span class="pre">asm_real_tangent_terms</span></tt> のパラメータ <tt class="docutils literal"><span class="pre">matl</span></tt> ）を宣言します。非線形項では、行列と右辺ベクトルの両方を満たす必要があることに注意してください。線形項の場合、行列項と宣言された項の右辺が式を満たしている場合は無視されます。</p>
<p>変数名とデータ名は2つの別々の配列で与えられます。これは、どちらの場合でも項の依存関係が同じではないためです。線形項は、データの値が変更された場合には再計算されなければなりませんが、変数の値が変更された場合は再計算されません。</p>
<p>上記の単純なDirichlet項を追加する関数は、次のように定義することができます。</p>
<div class="highlight-c++"><div class="highlight"><pre><span class="kt">size_t</span> <span class="nf">add_my_Dirichlet_condition_brick</span><span class="p">(</span><span class="n">model</span> <span class="o">&amp;</span><span class="n">md</span><span class="p">,</span> <span class="k">const</span> <span class="n">mesh_im</span> <span class="o">&amp;</span><span class="n">mim</span><span class="p">,</span>
                                        <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">varname</span><span class="p">,</span>
                                        <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">multname</span><span class="p">,</span>
                                        <span class="kt">size_t</span> <span class="n">region</span><span class="p">,</span>
                                        <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">dataname</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">pbrick</span> <span class="n">pbr</span> <span class="o">=</span> <span class="k">new</span> <span class="n">my_Dirichlet_brick</span><span class="p">;</span>
  <span class="n">model</span><span class="o">::</span><span class="n">termlist</span> <span class="n">tl</span><span class="p">;</span>
  <span class="n">tl</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">model</span><span class="o">::</span><span class="n">term_description</span><span class="p">(</span><span class="n">multname</span><span class="p">,</span> <span class="n">varname</span><span class="p">,</span> <span class="nb">true</span><span class="p">));</span>
  <span class="n">model</span><span class="o">::</span><span class="n">varnamelist</span> <span class="n">vl</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">varname</span><span class="p">);</span>
  <span class="n">vl</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">multname</span><span class="p">);</span>
  <span class="n">model</span><span class="o">::</span><span class="n">varnamelist</span> <span class="n">dl</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">dataname</span><span class="p">.</span><span class="n">size</span><span class="p">())</span> <span class="n">dl</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">dataname</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">md</span><span class="p">.</span><span class="n">add_brick</span><span class="p">(</span><span class="n">pbr</span><span class="p">,</span> <span class="n">vl</span><span class="p">,</span> <span class="n">dl</span><span class="p">,</span> <span class="n">tl</span><span class="p">,</span> <span class="n">model</span><span class="o">::</span><span class="n">mimlist</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">mim</span><span class="p">),</span> <span class="n">region</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>再びここでは、この項は対称であると宣言され、次に行列項とその転置が追加されます。</p>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <p class="logo"><a href="../index.html">
    <img class="logo" src="../static/logo_getfem_small.png" alt="Logo"/>
  </a></p>
  <h3><a href="../contents.html">目次</a></h3>
  <ul>
<li><a class="reference internal" href="#">modelオブジェクト</a></li>
<li><a class="reference internal" href="#the-br-object"><cite>brick</cite> オブジェクト</a></li>
<li><a class="reference internal" href="#how-to-build-a-new-brick">新しい項を作る方法</a></li>
<li><a class="reference internal" href="#how-to-add-the-brick-to-a-model">モデルに項を追加する方法</a></li>
</ul>

  <h4>前のトピックへ</h4>
  <p class="topless"><a href="model.html"
                        title="前の章へ">モデル記述と基本モデルブリック要素</a></p>
  <h4>次のトピックへ</h4>
  <p class="topless"><a href="model_generic_assembly.html"
                        title="次の章へ">汎用的な構築ブリック要素</a></p>            <h3>Download</h3>
            <p><a href="../download.html">Download GetFEM++ </a></p>
	    <h3>Main documentations</h3>
	    <ul>
              
	      <li><a href="index.html">GetFEM++ User documentation</a></li>
              <li><a href="../python/index.html">Python Interface</a></li>
	      <li><a href="../matlab/index.html">Matlab Interface</a></li>
	      <li><a href="../scilab/index.html">Scilab Interface</a></li>
	      <li><a href="../gmm/index.html"> Gmm++</a></li>
	      <li><a href="../project/index.html"> GetFEM++ project</a></li>
            </ul>

            <h3>Other resources</h3>
            <ul>
              <li><a href="../screenshots/shots.html">Screenshots</a></li>
              <li><a href="../links.html">Related links</a></li>
	      <li><a href="https://savannah.nongnu.org/projects/getfem">Hosted by Savannah </a></li>
              
              
            </ul>
<div id="searchbox" style="display: none">
  <h3>クイック検索</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="検索" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    モジュール、クラス、または関数名を入力してください
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="総合索引"
             >索引</a></li>
        <li class="right" >
          <a href="model_generic_assembly.html" title="汎用的な構築ブリック要素"
             >次へ</a> |</li>
        <li class="right" >
          <a href="model.html" title="モデル記述と基本モデルブリック要素"
             >前へ</a> |</li>
        <li><a href="https://savannah.nongnu.org/projects/getfem" <img src="../static/icon.png" alt=""
                 style="vertical-align: middle; margin-top: -1px"/></li></a>
        <li><a href="../index.html">GetFEM++</a> &raquo;</li>

          <li><a href="index.html" >ユーザドキュメント</a> &raquo;</li>
          <li><a href="model.html" >モデル記述と基本モデルブリック要素</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
      &copy; <a href="../copyright.html">Copyright</a> 2004-2018 GetFEM++ project.
    </div>
  </body>
</html>
